---

- include: packages.yml

- include: ssh.yml

- name: Setup dotfiles symlinks
  include_tasks: symlink.yml
  loop:
    - .vimrc
    - .bash_profile
    - .bash_aliases
    - .gitconfig
    - .tmux.conf
    - .config/liquidpromptrc
    - .config/htop/htoprc
    - .config/starship.toml
    - .gnupg/gpg.conf

- name: Template git config
  template:
    src: templates/git_user.j2
    dest: ~/.git_user
    owner: '{{ ansible_user_id }}'
    group: '{{ ansible_user_gid }}'
    mode: '0644'

- name: Ensure local bin directory exists
  file:
    path: '~/.local/bin'
    state: directory
    mode: '0755'

- name: Ensure that .bashrc load custom scripts
  blockinfile:
    path: ~/.bashrc
    block: |
      # User specific environment
      if ! [[ "$PATH" =~ "$HOME/.local/bin:$HOME/bin:" ]]
      then
          PATH="$HOME/.local/bin:$HOME/bin:$PATH"
      fi
      export PATH
      for file in ~/dotfiles/bashrc.d/*.sh
      do
          source $file
      done
      if [ -f ~/.bash_aliases ]; then
        . ~/.bash_aliases
      fi
      [[ $- == *i* ]] && eval "$(starship init bash)"
      [[ $- == *i* ]] && source <(npm completion)
