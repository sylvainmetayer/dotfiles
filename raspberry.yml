---
- hosts: raspberry

  vars:
    certbot_auto_renew: true
    certbot_auto_renew_user: "root"
    certbot_auto_renew_hour: "3"
    certbot_auto_renew_minute: "30"
    certbot_auto_renew_options: "--quiet --no-self-upgrade --renew-hook 'service nginx reload'"
    certbot_create_if_missing: true
    certbot_create_method: standalone
    certbot_admin_email: "{{ certbot_email }}"
    certbot_certs: []
    certbot_create_standalone_stop_services:
      - nginx

    pip_package: python3-pip
    docker_install_compose: true
    docker_users:
      - '{{ ansible_user_id }}'
  pre_tasks:
    - name: Include commons vars
      include_vars:
        file: 'commons_variables.yml'
    #- name: Update hostname
    #  hostname:
    #    name: 'raspberry'
  roles:
    - commons
    - { role: geerlingguy.pip, become: yes }
    - { role: geerlingguy.docker_arm, become: yes }
    - { role: geerlingguy.mysql, become: true }
    # Required before asdf and symlinks
    - raspberry
    - asdf
    - symlinks
    - raspberry_app_crm
    - { role: geerlingguy.certbot, become: true }
